# 快捷指令 - 极简修复版

## 问题诊断

如果连纯链接 `http://xhslink.com/o/16GReUbltyS` 都不行，说明「从输入获取 URL」操作失败了。

---

## 解决方案：直接使用剪贴板内容

### 修改步骤

#### 原来的配置：
```
1. 获取剪贴板
2. 从 剪贴板 获取 URL  ← 删除这一步
3. 从菜单中选择...
```

#### 修改后的配置：
```
1. 获取剪贴板
2. 从菜单中选择...  ← 直接进入菜单
```

然后在「获取 URL 内容」的 JSON 中：
- `"url"` 的值改为使用「剪贴板」变量（而不是"URL"变量）

---

## 详细操作步骤

### 1. 删除「从输入获取 URL」操作
- 在快捷指令中，找到第2步「从 剪贴板 获取 URL」
- 点击该操作
- 点击右上角的 `×` 删除

### 2. 调整流程
现在流程变成：
```
1. 获取剪贴板
2. 从菜单中选择（法意瑞/其他国家）
3. 如果...（设置变量）
4. 否则...（设置变量）
5. 结束 If
6. 获取 URL 内容（API调用）
```

### 3. 修改 JSON 中的变量引用
- 找到「获取 URL 内容」操作
- 点击 JSON 区域
- 找到 `"url"` 字段
- 点击当前的变量，删除它
- 选择「剪贴板」变量（应该在变量列表顶部）

### 4. 确认 JSON 最终样子
```
{
  "url": [剪贴板],         ← 改为剪贴板变量
  "appToken": [appToken],  ← 保持不变
  "tableId": [tableId],    ← 保持不变
  "async": true
}
```

---

## 为什么这样改？

iOS 的「从输入获取 URL」操作在某些情况下不稳定，直接使用剪贴板内容更可靠：
- ✅ 剪贴板里是什么就传什么
- ✅ 后端 API 会自动处理和验证 URL
- ✅ 减少中间步骤，减少出错可能

---

## 完整的快捷指令配置（修复版）

### 操作1：获取剪贴板
- 添加「获取剪贴板」操作

### 操作2：从菜单中选择
- 添加「从菜单中选择」操作
- 提示：`选择保存到哪个表格`
- 菜单项：
  - `法意瑞` （或改回"个人表格"）
  - `其他国家` （或改回"工作表格"）

### 操作3：如果
- 添加「如果」操作
- 条件：「菜单结果」等于 `法意瑞`
- **If 块中**：
  - 添加「设定变量」：变量名 `appToken`，值 `NNd8bJYazaBwHAsZ2z2cqsvmnqf`
  - 添加「设定变量」：变量名 `tableId`，值 `tblu1m2GPcFRNSPE`

### 操作4：否则
- 点击「否则」
- **Else 块中**：
  - 添加「设定变量」：变量名 `appToken`，值 `McFGbxqi6aSd0HsBCSlc5kI7nwc`
  - 添加「设定变量」：变量名 `tableId`，值 `tbltp6uHpdKRF68a`

### 操作5：结束 If
- 自动添加

### 操作6：获取 URL 内容
- 添加「获取 URL 内容」操作
- **URL**：`https://content-factory-jade-nine.vercel.app/api/xiaohongshu/quick-save`
- **方法**：`POST`
- **请求体**：`JSON`
- **JSON 内容**：
  ```
  {
    "url": [剪贴板],
    "appToken": [appToken],
    "tableId": [tableId],
    "async": true
  }
  ```
  **重要**：所有 `[变量]` 都必须是蓝色/橙色的变量标签，不是文本

### 操作7：从输入获取词典值
- 添加「从输入获取词典值」操作
- 获取：`message`
- 从：选择「URL 内容」变量

### 操作8：显示通知
- 添加「显示通知」操作
- 显示：选择「词典值」变量

---

## 测试步骤

1. 复制链接：`http://xhslink.com/o/16GReUbltyS`
2. 运行快捷指令
3. 选择「法意瑞」或「其他国家」
4. 查看结果

**预期成功**：显示"✅ 收到请求，正在后台保存..."

**如果还是失败**：
1. 检查剪贴板中是否真的有链接（可以先粘贴到备忘录确认）
2. 检查 JSON 中的变量是否都是**变量标签**（有颜色的），而不是纯文本
3. 截图发给我，我帮你看具体哪里有问题

---

## 调试技巧：显示变量值

如果还是不行，在「获取 URL 内容」**之前**添加调试步骤：

```
设定变量 appToken = ...
设定变量 tableId = ...
↓
显示通知 "URL: [剪贴板]"          ← 临时添加
显示通知 "appToken: [appToken]"  ← 临时添加
显示通知 "tableId: [tableId]"    ← 临时添加
↓
获取 URL 内容...
```

运行后查看3个通知，确认所有变量都有值且正确。

---

## 如果上面都不行：最简化测试

创建一个**全新的临时快捷指令**，只测试 API 是否正常：

1. 获取剪贴板
2. 获取 URL 内容
   - URL: `https://content-factory-jade-nine.vercel.app/api/xiaohongshu/quick-save`
   - 方法: POST
   - 请求体: JSON
   - JSON:
     ```json
     {
       "url": "http://xhslink.com/o/16GReUbltyS",
       "appToken": "NNd8bJYazaBwHAsZ2z2cqsvmnqf",
       "tableId": "tblu1m2GPcFRNSPE",
       "async": true
     }
     ```
     （全部用固定文本，不用变量）
3. 从输入获取词典值 message
4. 显示通知

**如果这个成功**：说明 API 正常，问题在变量传递
**如果这个也失败**：说明 API 或网络有问题

---

需要我帮你远程看一下快捷指令的配置吗？可以截图更多细节给我。
