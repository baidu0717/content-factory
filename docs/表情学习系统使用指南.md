# å°çº¢ä¹¦è¡¨æƒ…å­¦ä¹ ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“š ç³»ç»Ÿæ¦‚è¿°

è¡¨æƒ…å­¦ä¹ ç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•å’Œåˆ†æç”¨æˆ·çš„è¡¨æƒ…ä½¿ç”¨ä¹ æƒ¯ï¼Œè®© AI æ”¹å†™è¶Šæ¥è¶Šç¬¦åˆä½ çš„ä¸ªäººé£æ ¼ã€‚

## ğŸ¯ å·¥ä½œåŸç†

### 1. è®°å½•é˜¶æ®µ

å½“ä½ åœ¨"æ·»åŠ è¡¨æƒ…"ç•Œé¢ä¿å­˜å†…å®¹æ—¶ï¼Œç³»ç»Ÿä¼šï¼š
- è‡ªåŠ¨æå–ä½ ä½¿ç”¨çš„æ‰€æœ‰è¡¨æƒ…
- è®°å½•æ¯ä¸ªè¡¨æƒ…çš„ä½¿ç”¨æ¬¡æ•°
- ä¿å­˜ä½¿ç”¨åœºæ™¯ï¼ˆæ ‡é¢˜/æ­£æ–‡ï¼‰
- è®°å½•ä½¿ç”¨æ—¶é—´

### 2. å­¦ä¹ é˜¶æ®µ

ç³»ç»Ÿä¼šåˆ†æä½ çš„ä½¿ç”¨ä¹ æƒ¯ï¼š
- **æœ€å¸¸ç”¨è¡¨æƒ…**ï¼šæŒ‰ä½¿ç”¨é¢‘ç‡æ’åº
- **æœ€è¿‘ä½¿ç”¨è¡¨æƒ…**ï¼šæŒ‰æ—¶é—´æ’åº
- **ä½¿ç”¨åœºæ™¯åˆ†æ**ï¼šæ ‡é¢˜å’Œæ­£æ–‡çš„åå¥½
- **è¡¨æƒ…ç±»åˆ«åå¥½**ï¼šè¡¨æƒ…ç±»ã€æ‰‹åŠ¿ç±»ã€åŠ¨ä½œç±»ç­‰

### 3. åº”ç”¨é˜¶æ®µ

åœ¨ AI æ”¹å†™æ—¶ï¼š
- ä¼˜å…ˆä½¿ç”¨ä½ å¸¸ç”¨çš„è¡¨æƒ…
- ä¿æŒä½ çš„ä¸ªæ€§åŒ–é£æ ¼
- é¿å…ä½¿ç”¨ä½ ä¸å–œæ¬¢çš„è¡¨æƒ…

## ğŸ’» API å‡½æ•°

### è®°å½•è¡¨æƒ…ä½¿ç”¨

```typescript
import { recordEmojiUsage } from '@/lib/emoji-learning'

// è®°å½•æ ‡é¢˜ä¸­çš„è¡¨æƒ…
recordEmojiUsage('è¿™ä¸ªå¥½ç‰©å¤ªæ£’äº†[ç¬‘å“­R]', 'title')

// è®°å½•æ­£æ–‡ä¸­çš„è¡¨æƒ…
recordEmojiUsage('ç”¨äº†ä¸€ä¸ªæœˆæ•ˆæœå¾ˆæ˜æ˜¾[èŒèŒå“’R]æ¨èå¤§å®¶è¯•è¯•[æ‹¿èµ°R]', 'content')
```

### è·å–ä½¿ç”¨ç»Ÿè®¡

```typescript
import { getEmojiUsageStats } from '@/lib/emoji-learning'

const stats = getEmojiUsageStats()
console.log('æ€»ä½¿ç”¨æ¬¡æ•°:', stats.totalUsage)
console.log('å¸¸ç”¨è¡¨æƒ…:', stats.favoriteEmojis)
console.log('æœ€è¿‘ä½¿ç”¨:', stats.recentEmojis)
```

### è·å–ç”¨æˆ·åå¥½ï¼ˆç”¨äº AIï¼‰

```typescript
import { getUserEmojiPreferences } from '@/lib/emoji-learning'

const preferences = getUserEmojiPreferences()
// è¿”å›æ ¼å¼åŒ–çš„åå¥½æ–‡æœ¬ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ åˆ° AI æç¤ºè¯ä¸­
```

### è·å–è¡¨æƒ…å»ºè®®

```typescript
import { getEmojiSuggestions } from '@/lib/emoji-learning'

// è·å–æ ‡é¢˜è¡¨æƒ…å»ºè®®
const titleEmojis = getEmojiSuggestions('æ ‡é¢˜å†…å®¹', 'title')

// è·å–æ­£æ–‡è¡¨æƒ…å»ºè®®
const contentEmojis = getEmojiSuggestions('æ­£æ–‡å†…å®¹', 'content')
```

### åˆ†æä½¿ç”¨è¶‹åŠ¿

```typescript
import { analyzeEmojiTrends } from '@/lib/emoji-learning'

const trends = analyzeEmojiTrends()
console.log('æœ€å¸¸ç”¨çš„ç±»åˆ«:', trends.mostUsedCategory)
console.log('å„ç±»åˆ«è¡¨æƒ…:', trends.categories)
```

### ç®¡ç†è®°å½•

```typescript
import {
  clearEmojiUsageRecords,
  exportEmojiUsageRecords,
  importEmojiUsageRecords
} from '@/lib/emoji-learning'

// æ¸…é™¤æ‰€æœ‰è®°å½•
clearEmojiUsageRecords()

// å¯¼å‡ºè®°å½•ï¼ˆJSON æ ¼å¼ï¼‰
const data = exportEmojiUsageRecords()

// å¯¼å…¥è®°å½•
importEmojiUsageRecords(data)
```

## ğŸ”§ é›†æˆåˆ°æ”¹å†™ API

### å½“å‰å®ç°ï¼ˆv1ï¼‰

åœ¨æ”¹å†™ API ä¸­å·²ç»å†…ç½®äº†é€šç”¨çš„è¡¨æƒ…å»ºè®®ï¼š

```typescript
// app/api/xiaohongshu/rewrite/route.ts

// æ­£æ–‡æ”¹å†™æ—¶ä¼šè‡ªåŠ¨æ·»åŠ è¡¨æƒ…
const emojiGuide = `
å¸¸ç”¨è¡¨æƒ…åˆ—è¡¨ï¼š
1. è¡¨æƒ…ç±»ï¼š[èŒèŒå“’R] [å“ˆå“ˆR] [ç¬‘å“­R] ...
2. æ‰‹åŠ¿ç±»ï¼š[æ¯”å¿ƒR] [ç‚¹èµR] [èµR] ...
3. åŠ¨ä½œç±»ï¼š[åƒç“œR] [å†²é¸­R] [æ‰“å¡R] ...
`
```

### å‡çº§æ–¹æ¡ˆï¼ˆv2 - ä¸ªæ€§åŒ–ï¼‰

åœ¨å‰ç«¯è°ƒç”¨æ”¹å†™ API æ—¶ä¼ é€’ç”¨æˆ·åå¥½ï¼š

**æ­¥éª¤ 1**ï¼šä¿®æ”¹æ”¹å†™ APIï¼Œæ¥å—ç”¨æˆ·åå¥½å‚æ•°

```typescript
// app/api/xiaohongshu/rewrite/route.ts

export async function POST(request: NextRequest) {
  const {
    title,
    content,
    titlePrompt,
    contentPrompt,
    userEmojiPreferences  // æ–°å¢ï¼šç”¨æˆ·è¡¨æƒ…åå¥½
  } = await request.json()

  // ...

  // åœ¨æ„å»ºæç¤ºè¯æ—¶ä½¿ç”¨ç”¨æˆ·åå¥½
  const fullContentPrompt = `${contentPrompt}

${userEmojiPreferences || emojiGuide}  // ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·åå¥½

åŸæ­£æ–‡ï¼š${content}

è¯·è¾“å‡ºæ”¹å†™åçš„æ­£æ–‡ï¼š`

  // ...
}
```

**æ­¥éª¤ 2**ï¼šå‰ç«¯è°ƒç”¨æ—¶ä¼ é€’åå¥½

```typescript
// app/rewrite/page.tsx

import { getUserEmojiPreferences } from '@/lib/emoji-learning'

const handleRewrite = async () => {
  // è·å–ç”¨æˆ·è¡¨æƒ…åå¥½
  const userEmojiPreferences = getUserEmojiPreferences()

  const response = await fetch('/api/xiaohongshu/rewrite', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      title: editableTitle,
      content: editableContent,
      contentPrompt: contentPrompt,
      userEmojiPreferences  // ä¼ é€’ç”¨æˆ·åå¥½
    })
  })

  // ...
}
```

## ğŸ“Š æ•°æ®å­˜å‚¨

### å­˜å‚¨ä½ç½®
- **æµè§ˆå™¨ localStorage**
- Key: `xhs-emoji-usage`
- æœ€å¤šä¿å­˜ 100 æ¡è®°å½•

### æ•°æ®ç»“æ„

```typescript
interface EmojiUsageRecord {
  emoji: string          // è¡¨æƒ…ä»£ç ï¼Œå¦‚ï¼š[èŒèŒå“’R]
  count: number          // ä½¿ç”¨æ¬¡æ•°
  lastUsed: number       // æœ€åä½¿ç”¨æ—¶é—´æˆ³
  contexts: string[]     // ä½¿ç”¨åœºæ™¯ï¼ˆæœ€å¤š5ä¸ªï¼‰
}
```

### ç¤ºä¾‹æ•°æ®

```json
[
  {
    "emoji": "[ç¬‘å“­R]",
    "count": 15,
    "lastUsed": 1707123456789,
    "contexts": ["content", "title", "content", "content", "title"]
  },
  {
    "emoji": "[èŒèŒå“’R]",
    "count": 12,
    "lastUsed": 1707123456700,
    "contexts": ["content", "content", "content", "content", "content"]
  }
]
```

## ğŸ¨ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šé¦–æ¬¡ä½¿ç”¨

1. ç”¨æˆ·æ”¹å†™å®Œæˆåç‚¹å‡»"æ·»åŠ è¡¨æƒ…"
2. æ‰‹åŠ¨é€‰æ‹©å–œæ¬¢çš„è¡¨æƒ…
3. ç‚¹å‡»"ä¿å­˜è¡¨æƒ…"
4. ç³»ç»Ÿè®°å½•è¡¨æƒ…ä½¿ç”¨

**ç»“æœ**ï¼šå»ºç«‹åˆå§‹åå¥½

### åœºæ™¯ 2ï¼šæŒç»­ä½¿ç”¨

1. ç”¨æˆ·å¤šæ¬¡ä½¿ç”¨è¡¨æƒ…åŠŸèƒ½
2. ç³»ç»Ÿç´¯ç§¯ä½¿ç”¨æ•°æ®
3. åˆ†æå‡ºç”¨æˆ·åå¥½

**ç»“æœ**ï¼š
- å‘ç°ç”¨æˆ·å–œæ¬¢ `[ç¬‘å“­R]` `[èŒèŒå“’R]` `[æ‹¿èµ°R]`
- ä¸å¸¸ç”¨ `[æš—ä¸­è§‚å¯ŸR]` `[é…·ç›–R]`

### åœºæ™¯ 3ï¼šAI è‡ªåŠ¨æ·»åŠ 

1. ç”¨æˆ·å¯ç”¨ AI è‡ªåŠ¨æ·»åŠ è¡¨æƒ…
2. AI è¯»å–ç”¨æˆ·åå¥½
3. åœ¨æ”¹å†™æ—¶è‡ªåŠ¨æ·»åŠ ç”¨æˆ·å¸¸ç”¨çš„è¡¨æƒ…

**ç»“æœ**ï¼šç”Ÿæˆçš„å†…å®¹æ›´ç¬¦åˆç”¨æˆ·é£æ ¼

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### æŸ¥çœ‹å½“å‰è®°å½•

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
// æŸ¥çœ‹æ‰€æœ‰è®°å½•
console.log(localStorage.getItem('xhs-emoji-usage'))

// æˆ–ä½¿ç”¨å°è£…çš„å‡½æ•°
import { getEmojiUsageStats } from '@/lib/emoji-learning'
console.log(getEmojiUsageStats())
```

### æŸ¥çœ‹å­¦ä¹ æ•ˆæœ

```javascript
import { getUserEmojiPreferences } from '@/lib/emoji-learning'
console.log(getUserEmojiPreferences())
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ç”¨æˆ·è¡¨æƒ…ä½¿ç”¨åå¥½ï¼ˆæ ¹æ®å†å²è®°å½•ï¼‰ï¼š
- æ€»ä½¿ç”¨æ¬¡æ•°ï¼š45
- å¸¸ç”¨è¡¨æƒ…æ•°é‡ï¼š12

ç”¨æˆ·æœ€å¸¸ç”¨çš„è¡¨æƒ…ï¼ˆä¼˜å…ˆä½¿ç”¨ï¼‰ï¼š
[ç¬‘å“­R] [èŒèŒå“’R] [æ‹¿èµ°R] [æ¯”å¿ƒR] [èµR] [å“ˆå“ˆR] [å†²é¸­R] [æ´¾å¯¹R]

ç”¨æˆ·æœ€è¿‘ä½¿ç”¨çš„è¡¨æƒ…ï¼ˆæ¨èä½¿ç”¨ï¼‰ï¼š
[ç¬‘å“­R] [æ‹¿èµ°R] [èŒèŒå“’R] [æ´¾å¯¹R] [èµR]

å»ºè®®ï¼šåœ¨æ”¹å†™æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ç”¨æˆ·å¸¸ç”¨çš„è¡¨æƒ…ï¼Œä¿æŒç”¨æˆ·çš„ä¸ªæ€§åŒ–é£æ ¼ã€‚
```

## ğŸ“ˆ ä¼˜åŒ–å»ºè®®

### 1. å†·å¯åŠ¨é—®é¢˜

**é—®é¢˜**ï¼šæ–°ç”¨æˆ·æ²¡æœ‰å†å²æ•°æ®
**è§£å†³**ï¼šæä¾›é»˜è®¤æ¨è + å¿«é€Ÿå­¦ä¹ æ¨¡å¼

```typescript
// å‰ 5 æ¬¡ä½¿ç”¨æ—¶ï¼Œæä¾›æµè¡Œè¡¨æƒ…å»ºè®®
if (stats.totalUsage < 5) {
  return getPopularEmojis()  // è¿”å›å¤§ä¼—å–œæ¬¢çš„è¡¨æƒ…
}
```

### 2. è¿‡æ—¶æ•°æ®

**é—®é¢˜**ï¼šç”¨æˆ·åå¥½å¯èƒ½éšæ—¶é—´æ”¹å˜
**è§£å†³**ï¼šæŒ‰æ—¶é—´è¡°å‡æƒé‡

```typescript
// è®¡ç®—åŠ æƒåˆ†æ•°ï¼ˆæœ€è¿‘ä½¿ç”¨çš„æƒé‡æ›´é«˜ï¼‰
const weightedScore = record.count * (1 + timeWeight)
```

### 3. åœºæ™¯æ„ŸçŸ¥

**é—®é¢˜**ï¼šä¸åŒå†…å®¹ç±»å‹é€‚åˆä¸åŒè¡¨æƒ…
**è§£å†³**ï¼šè®°å½•å†…å®¹ç±»å‹å’Œè¡¨æƒ…çš„å…³è”

```typescript
// è®°å½•æ—¶é™„å¸¦å†…å®¹ç±»å‹
recordEmojiUsage(text, 'beauty-review')  // ç¾å¦†æµ‹è¯„
recordEmojiUsage(text, 'travel-guide')   // æ—…è¡Œæ”»ç•¥
```

### 4. å¤šè®¾å¤‡åŒæ­¥

**é—®é¢˜**ï¼šlocalStorage æ— æ³•è·¨è®¾å¤‡
**è§£å†³**ï¼š
- æ–¹æ¡ˆ Aï¼šæä¾›å¯¼å‡º/å¯¼å…¥åŠŸèƒ½
- æ–¹æ¡ˆ Bï¼šåŒæ­¥åˆ°äº‘ç«¯ï¼ˆéœ€è¦ç”¨æˆ·ç™»å½•ï¼‰

## âš ï¸ æ³¨æ„äº‹é¡¹

### éšç§ä¿æŠ¤

- æ•°æ®ä»…å­˜å‚¨åœ¨ç”¨æˆ·æœ¬åœ°
- ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨
- ç”¨æˆ·å¯éšæ—¶æ¸…é™¤

### å­˜å‚¨é™åˆ¶

- localStorage ä¸€èˆ¬æœ‰ 5-10MB é™åˆ¶
- æ¯æ¡è®°å½•çº¦ 100-200 å­—èŠ‚
- 100 æ¡è®°å½•çº¦ 10-20KBï¼Œè¿œä½äºé™åˆ¶

### å…¼å®¹æ€§

- éœ€è¦æµè§ˆå™¨æ”¯æŒ localStorage
- æ— ç—•æ¨¡å¼ä¸‹æ•°æ®ä¼šåœ¨å…³é—­æ—¶æ¸…é™¤
- å»ºè®®æä¾›å¯¼å‡ºåŠŸèƒ½å¤‡ä»½

## ğŸš€ æœªæ¥è®¡åˆ’

### v1.0ï¼ˆå½“å‰ï¼‰
- âœ… åŸºç¡€è®°å½•åŠŸèƒ½
- âœ… ç»Ÿè®¡å’Œåˆ†æ
- âœ… æ‰‹åŠ¨æ·»åŠ è¡¨æƒ…æ—¶è®°å½•

### v2.0ï¼ˆä¸‹ä¸€ç‰ˆï¼‰
- [ ] ä¸ªæ€§åŒ– AI æ”¹å†™
- [ ] åœºæ™¯æ„ŸçŸ¥æ¨è
- [ ] æ—¶é—´è¡°å‡æƒé‡

### v3.0ï¼ˆè¿œæœŸï¼‰
- [ ] äº‘ç«¯åŒæ­¥
- [ ] ååŒè¿‡æ»¤æ¨è
- [ ] A/B æµ‹è¯•æ•ˆæœ

## ğŸ“š å‚è€ƒèµ„æ–™

- [localStorage API](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage)
- [ååŒè¿‡æ»¤ç®—æ³•](https://en.wikipedia.org/wiki/Collaborative_filtering)
- [æ¨èç³»ç»Ÿæœ€ä½³å®è·µ](https://www.oreilly.com/library/view/practical-recommender-systems/9781617292702/)
