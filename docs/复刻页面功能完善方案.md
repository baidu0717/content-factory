# å¤åˆ»é¡µé¢åŠŸèƒ½å®Œå–„æ–¹æ¡ˆ

**åˆ›å»ºæ—¥æœŸ**ï¼š2026-02-06
**ç›®çš„**ï¼šå®Œå–„ `/rewrite` é¡µé¢çš„å›¾ç‰‡ä¸Šä¼ ã€é¢„è§ˆå’Œå‘å¸ƒåŠŸèƒ½

---

## ğŸ“Š å½“å‰åŠŸèƒ½çŠ¶æ€

### âœ… å·²å®Œæˆçš„åŠŸèƒ½

#### 1. å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
**ä½ç½®**ï¼š`app/rewrite/page.tsx:707-758`

**åŠŸèƒ½**ï¼š
- âœ… ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
- âœ… æœ€å¤š18å¼ å›¾ç‰‡
- âœ… æ”¯æŒ JPGã€PNG æ ¼å¼
- âœ… å›¾ç‰‡é¢„è§ˆï¼ˆ3åˆ—ç½‘æ ¼ï¼‰
- âœ… åˆ é™¤å›¾ç‰‡
- âœ… æ˜¾ç¤ºå›¾ç‰‡åºå·

**ä»£ç **ï¼š
```typescript
const handleFileUpload = (files: FileList | null) => {
  // éªŒè¯æ–‡ä»¶ç±»å‹
  // é™åˆ¶æœ€å¤š18å¼ 
  // ç”Ÿæˆé¢„è§ˆURL
}
```

#### 2. é¢„è§ˆåŠŸèƒ½
**ä½ç½®**ï¼š`components/XiaohongshuPreview.tsx`

**åŠŸèƒ½**ï¼š
- âœ… å›¾ç‰‡è½®æ’­ï¼ˆ3:4æ¯”ä¾‹ï¼‰
- âœ… æ˜¾ç¤ºæ ‡é¢˜
- âœ… æ˜¾ç¤ºæ­£æ–‡
- âœ… æ˜¾ç¤ºè¯é¢˜æ ‡ç­¾
- âœ… å›¾ç‰‡æŒ‡ç¤ºå™¨
- âœ… å·¦å³åˆ‡æ¢æŒ‰é’®

**è°ƒç”¨æ–¹å¼**ï¼š
```typescript
<XiaohongshuPreview
  isOpen={showPreview}
  onClose={() => setShowPreview(false)}
  title={editableTitle}
  content={editableContent}
  tags={editableTags}
  images={previewUrls}  // æœ¬åœ°ä¸Šä¼ çš„å›¾ç‰‡é¢„è§ˆURL
/>
```

#### 3. AIæ”¹å†™åŠŸèƒ½
- âœ… æ”¹å†™æ ‡é¢˜
- âœ… æ”¹å†™æ­£æ–‡
- âœ… ä¸€é”®æ”¹å†™å…¨éƒ¨
- âœ… è‡ªå®šä¹‰æç¤ºè¯
- âœ… å†å²ç‰ˆæœ¬è®°å½•

---

### âš ï¸ éƒ¨åˆ†å®Œæˆçš„åŠŸèƒ½

#### å‘å¸ƒåŠŸèƒ½
**ä½ç½®**ï¼š`app/rewrite/page.tsx:274-337`

**å½“å‰çŠ¶æ€**ï¼š
```typescript
// TODO: éœ€è¦å…ˆåˆ›å»ºæ–‡ç« è®°å½•ï¼Œç„¶åè°ƒç”¨å‘å¸ƒAPI
console.log('[å‘å¸ƒ] å‡†å¤‡å‘å¸ƒæ–‡ç« :', article)
alert('å‘å¸ƒåŠŸèƒ½å¼€å‘ä¸­...')
```

**ç¼ºå°‘çš„æ­¥éª¤**ï¼š
1. âŒ å°†æ–‡ç« ä¿å­˜åˆ°æ•°æ®åº“
2. âœ… ä¸Šä¼ å›¾ç‰‡åˆ° Vercel Blobï¼ˆä»£ç å·²å†™ï¼Œæœªé›†æˆï¼‰
3. âœ… è°ƒç”¨å°çº¢ä¹¦å‘å¸ƒ APIï¼ˆä»£ç å·²å†™ï¼Œæœªé›†æˆï¼‰
4. âŒ æ˜¾ç¤ºäºŒç»´ç ä¾›æ‰‹æœºæ‰«ç 

---

### âŒ æœªå®ç°çš„åŠŸèƒ½

#### æœ¬åœ°å›¾ç‰‡è¯†åˆ«ï¼ˆç”¨æˆ·æ–°éœ€æ±‚ï¼‰

**å¯èƒ½çš„å«ä¹‰**ï¼š
1. **æ–¹æ¡ˆA**ï¼šOCRè¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—
2. **æ–¹æ¡ˆB**ï¼šè¯†åˆ«å›¾ç‰‡å†…å®¹ç”Ÿæˆæè¿°
3. **æ–¹æ¡ˆC**ï¼šä»å›¾ç‰‡æå–å…ƒæ•°æ®ï¼ˆEXIFï¼‰
4. **æ–¹æ¡ˆD**ï¼šå›¾ç‰‡åˆ†ç±»/æ ‡ç­¾è¯†åˆ«

**éœ€è¦æ¾„æ¸…**ï¼šç”¨æˆ·å¸Œæœ›"è¯†åˆ«"å›¾ç‰‡çš„ä»€ä¹ˆä¿¡æ¯ï¼Ÿ

---

## ğŸ¯ å®Œå–„æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå®Œå–„å‘å¸ƒåŠŸèƒ½ï¼ˆæ¨èï¼‰

**ç›®æ ‡**ï¼šè®©å¤åˆ»é¡µé¢çš„"å‘å¸ƒç¬”è®°"æŒ‰é’®çœŸæ­£å·¥ä½œ

#### æ­¥éª¤1ï¼šåˆ›å»ºä¿å­˜æ–‡ç« çš„APIï¼ˆå¦‚æœæ²¡æœ‰ï¼‰

**æ–‡ä»¶**ï¼š`app/api/articles/route.ts`

```typescript
export async function POST(req: NextRequest) {
  const { title, content, tags, images } = await req.json()

  const db = getDb()
  const stmt = db.prepare(`
    INSERT INTO articles (title, content, tags, images, status, created_at)
    VALUES (?, ?, ?, ?, 'draft', CURRENT_TIMESTAMP)
  `)

  const result = stmt.run(
    title,
    JSON.stringify(content),
    JSON.stringify(tags),
    JSON.stringify(images)
  )

  return NextResponse.json({
    success: true,
    data: { articleId: result.lastInsertRowid }
  })
}
```

#### æ­¥éª¤2ï¼šä¿®æ”¹å¤åˆ»é¡µé¢çš„å‘å¸ƒé€»è¾‘

**æ–‡ä»¶**ï¼š`app/rewrite/page.tsx:274-337`

```typescript
const handlePublish = async () => {
  // 1. ä¸Šä¼ å›¾ç‰‡åˆ° Vercel Blob
  const formData = new FormData()
  uploadedFiles.forEach(file => formData.append('images', file))

  const uploadResponse = await fetch('/api/upload/images', {
    method: 'POST',
    body: formData
  })
  const { urls: imageUrls } = await uploadResponse.json()

  // 2. ä¿å­˜æ–‡ç« åˆ°æ•°æ®åº“
  const saveResponse = await fetch('/api/articles', {
    method: 'POST',
    body: JSON.stringify({
      title: editableTitle,
      content: editableContent,
      tags: editableTags.split(/\s+/),
      images: imageUrls
    })
  })
  const { articleId } = await saveResponse.json()

  // 3. è°ƒç”¨å‘å¸ƒAPI
  const publishResponse = await fetch('/api/xiaohongshu/publish', {
    method: 'POST',
    body: JSON.stringify({ articleId })
  })
  const result = await publishResponse.json()

  // 4. æ˜¾ç¤ºäºŒç»´ç 
  setPublishResult({
    qrCodeUrl: result.data.qrCodeUrl,
    noteId: result.data.noteId
  })
}
```

#### æ­¥éª¤3ï¼šæ·»åŠ äºŒç»´ç æ˜¾ç¤ºç•Œé¢

**æ–‡ä»¶**ï¼š`app/rewrite/page.tsx`

```tsx
{publishResult && (
  <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
    <div className="bg-white rounded-2xl p-6 max-w-sm">
      <h3 className="text-lg font-bold mb-4">æ‰«ç å‘å¸ƒåˆ°å°çº¢ä¹¦</h3>
      <img src={publishResult.qrCodeUrl} alt="å‘å¸ƒäºŒç»´ç " className="w-full" />
      <p className="text-sm text-gray-500 mt-4 text-center">
        è¯·ç”¨æ‰‹æœºå¾®ä¿¡æ‰«ç å®Œæˆå‘å¸ƒ
      </p>
      <button
        onClick={() => setPublishResult(null)}
        className="w-full mt-4 px-4 py-2 bg-gray-200 rounded-lg"
      >
        å…³é—­
      </button>
    </div>
  </div>
)}
```

---

### æ–¹æ¡ˆ2ï¼šæœ¬åœ°å›¾ç‰‡è¯†åˆ«åŠŸèƒ½

#### å¦‚æœæ˜¯"OCRè¯†åˆ«å›¾ç‰‡æ–‡å­—"

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨ Gemini Vision APIï¼ˆå·²æœ‰ API Keyï¼‰
2. æˆ–ä½¿ç”¨ OCR.space ç­‰å…è´¹API

**å®ç°æ­¥éª¤**ï¼š
```typescript
// 1. ä¸Šä¼ å›¾ç‰‡åè‡ªåŠ¨è¯†åˆ«
const handleFileUpload = async (files: FileList | null) => {
  // ä¸Šä¼ å›¾ç‰‡
  setUploadedFiles(newFiles)

  // è‡ªåŠ¨OCRè¯†åˆ«
  for (const file of newFiles) {
    const text = await recognizeText(file)
    console.log('è¯†åˆ«åˆ°çš„æ–‡å­—:', text)
  }
}

// 2. OCRè¯†åˆ«å‡½æ•°
async function recognizeText(file: File): Promise<string> {
  const formData = new FormData()
  formData.append('image', file)

  const response = await fetch('/api/ocr', {
    method: 'POST',
    body: formData
  })

  const result = await response.json()
  return result.text
}
```

#### å¦‚æœæ˜¯"è¯†åˆ«å›¾ç‰‡å†…å®¹ç”Ÿæˆæè¿°"

**ä½¿ç”¨ Gemini Vision API**ï¼š

```typescript
async function describeImage(file: File): Promise<string> {
  const base64 = await fileToBase64(file)

  const response = await fetch('/api/gemini/vision', {
    method: 'POST',
    body: JSON.stringify({
      image: base64,
      prompt: 'è¯·æè¿°è¿™å¼ å›¾ç‰‡çš„å†…å®¹ï¼Œé€‚åˆç”¨ä½œå°çº¢ä¹¦ç¬”è®°é…å›¾è¯´æ˜'
    })
  })

  const result = await response.json()
  return result.description
}
```

#### å¦‚æœæ˜¯"æå–å›¾ç‰‡å…ƒæ•°æ®"

**ä½¿ç”¨ exif-js åº“**ï¼š

```typescript
import EXIF from 'exif-js'

function extractMetadata(file: File) {
  EXIF.getData(file, function() {
    const make = EXIF.getTag(this, 'Make')        // ç›¸æœºå“ç‰Œ
    const model = EXIF.getTag(this, 'Model')      // ç›¸æœºå‹å·
    const date = EXIF.getTag(this, 'DateTime')    // æ‹æ‘„æ—¶é—´
    const gps = EXIF.getTag(this, 'GPSLatitude')  // GPSä½ç½®

    console.log('ç›¸æœº:', make, model)
    console.log('æ—¶é—´:', date)
  })
}
```

---

## ğŸ”‘ ç¬¬ä¸‰æ–¹APIé…ç½®

### MyAIBot APIï¼ˆå°çº¢ä¹¦å‘å¸ƒï¼‰

**æ–‡æ¡£**ï¼šhttps://www.myaibot.vip/docs/api

**é…ç½®æ–‡ä»¶**ï¼š`.env.local`
```env
MYAIBOT_API_KEY=rn_95b1c43fa86396bbb84b2a1c86863d7303c6d40cc217e69ea7133296cff2
```

**APIç«¯ç‚¹**ï¼š
```
POST https://www.myaibot.vip/api/rednote/publish
```

**è¯·æ±‚æ ¼å¼**ï¼š
```json
{
  "api_key": "rn_95b1c43...",
  "type": "normal",
  "title": "ç¬”è®°æ ‡é¢˜ï¼ˆâ‰¤20å­—ï¼‰",
  "content": "æ­£æ–‡å†…å®¹ï¼ˆâ‰¤1000å­—ï¼‰",
  "images": [
    "https://image-url-1.jpg",
    "https://image-url-2.jpg"
  ]
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "data": {
    "id": "note_123",
    "note_id": "64f8e7a1000000001a00b2c3",
    "title": "ç¬”è®°æ ‡é¢˜",
    "qrCodeUrl": "https://www.myaibot.vip/qr/xxx.png",
    "publishUrl": "https://www.xiaohongshu.com/discovery/item/xxx",
    "coverImage": "https://image-url-1.jpg",
    "createdAt": 1627891234567
  },
  "message": "å‘å¸ƒæˆåŠŸï¼è¯·æ‰«æäºŒç»´ç åœ¨æ‰‹æœºç«¯å®Œæˆå‘å¸ƒ"
}
```

**å›¾ç‰‡è¦æ±‚**ï¼š
- æ ¼å¼ï¼šPNGã€JPGã€JPEGã€WEBPï¼ˆä¸æ”¯æŒGIFï¼‰
- æ•°é‡ï¼šæœ€å¤š18å¼ 
- å¤§å°ï¼šå•å¼  â‰¤ 32MB
- åˆ†è¾¨ç‡ï¼šâ‰¥ 720Ã—960åƒç´ 
- **é‡è¦**ï¼šå›¾ç‰‡å¿…é¡»æ˜¯å¯å…¬å¼€è®¿é—®çš„URLï¼ˆéœ€è¦å…ˆä¸Šä¼ åˆ°Vercel Blobï¼‰

---

### Vercel Blobï¼ˆå›¾ç‰‡å­˜å‚¨ï¼‰

**å·²é…ç½®**ï¼š
```typescript
import { put } from '@vercel/blob'

// ä¸Šä¼ å•å¼ å›¾ç‰‡
const blob = await put(filename, file, {
  access: 'public'
})
console.log(blob.url) // è¿”å›å¯è®¿é—®çš„URL
```

**APIç«¯ç‚¹**ï¼š`/api/upload/images`ï¼ˆéœ€æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼‰

---

### Gemini Vision APIï¼ˆå›¾ç‰‡è¯†åˆ«ï¼Œå¯é€‰ï¼‰

**é…ç½®æ–‡ä»¶**ï¼š`.env.local`
```env
GEMINI_TEXT_API_KEY=AIzaSy***å·²éšè—***
```

**ç”¨é€”**ï¼š
- OCRè¯†åˆ«å›¾ç‰‡æ–‡å­—
- ç”Ÿæˆå›¾ç‰‡æè¿°
- å›¾ç‰‡å†…å®¹åˆ†æ

---

## ğŸ“ å¼€å‘ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®Œæˆï¼‰

1. **å®Œå–„å‘å¸ƒåŠŸèƒ½**
   - [ ] æ£€æŸ¥/åˆ›å»º `/api/upload/images` ç«¯ç‚¹
   - [ ] æ£€æŸ¥/åˆ›å»º `/api/articles` ç«¯ç‚¹
   - [ ] ä¿®æ”¹ `app/rewrite/page.tsx` çš„ `handlePublish` å‡½æ•°
   - [ ] æ·»åŠ äºŒç»´ç æ˜¾ç¤ºç•Œé¢
   - [ ] æµ‹è¯•å®Œæ•´å‘å¸ƒæµç¨‹

### ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®å®Œæˆï¼‰

2. **ä¼˜åŒ–å›¾ç‰‡ä¸Šä¼ ä½“éªŒ**
   - [ ] æ·»åŠ ä¸Šä¼ è¿›åº¦æ¡
   - [ ] æ”¯æŒæ‹–æ‹½æ’åºå›¾ç‰‡
   - [ ] å›¾ç‰‡å‹ç¼©ä¼˜åŒ–ï¼ˆå¤§äº5MBè‡ªåŠ¨å‹ç¼©ï¼‰
   - [ ] æ‰¹é‡åˆ é™¤å›¾ç‰‡

3. **å®Œå–„é¢„è§ˆåŠŸèƒ½**
   - [ ] æ·»åŠ åˆ†äº«æŒ‰é’®
   - [ ] æ”¯æŒå…¨å±é¢„è§ˆ
   - [ ] æ˜¾ç¤ºå›¾ç‰‡å°ºå¯¸ä¿¡æ¯

### ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰

4. **å›¾ç‰‡è¯†åˆ«åŠŸèƒ½**ï¼ˆéœ€è¦å…ˆæ¾„æ¸…éœ€æ±‚ï¼‰
   - [ ] OCRè¯†åˆ«å›¾ç‰‡æ–‡å­—
   - [ ] æˆ– AIç”Ÿæˆå›¾ç‰‡æè¿°
   - [ ] æˆ– æå–å›¾ç‰‡å…ƒæ•°æ®

---

## â“ éœ€è¦æ¾„æ¸…çš„é—®é¢˜

### å…³äº"æœ¬åœ°å›¾ç‰‡è¯†åˆ«"

**è¯·æ˜ç¡®ä»¥ä¸‹é—®é¢˜**ï¼š

1. **è¯†åˆ«ä»€ä¹ˆä¿¡æ¯ï¼Ÿ**
   - A. è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ï¼ˆOCRï¼‰
   - B. è¯†åˆ«å›¾ç‰‡å†…å®¹å¹¶ç”Ÿæˆæè¿°
   - C. è¯†åˆ«å›¾ç‰‡æ‹æ‘„ä¿¡æ¯ï¼ˆç›¸æœºã€æ—¶é—´ã€åœ°ç‚¹ï¼‰
   - D. è¯†åˆ«å›¾ç‰‡ä¸»é¢˜/æ ‡ç­¾

2. **è¯†åˆ«ååšä»€ä¹ˆï¼Ÿ**
   - A. è‡ªåŠ¨å¡«å……åˆ°æ­£æ–‡ä¸­
   - B. ä½œä¸ºæ ‡ç­¾å»ºè®®
   - C. ç”¨äºå›¾ç‰‡æ’åº
   - D. ä»…ä¾›å‚è€ƒæŸ¥çœ‹

3. **ä½•æ—¶è§¦å‘è¯†åˆ«ï¼Ÿ**
   - A. ä¸Šä¼ å›¾ç‰‡æ—¶è‡ªåŠ¨è¯†åˆ«
   - B. ç‚¹å‡»æŒ‰é’®æ‰‹åŠ¨è¯†åˆ«
   - C. åœ¨é¢„è§ˆæ—¶æ˜¾ç¤ºè¯†åˆ«ç»“æœ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆå®Œå–„å‘å¸ƒåŠŸèƒ½ï¼‰

### 1. æ£€æŸ¥ç°æœ‰APIç«¯ç‚¹

```bash
# æ£€æŸ¥æ˜¯å¦å­˜åœ¨å›¾ç‰‡ä¸Šä¼ API
ls app/api/upload/images/route.ts

# æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ–‡ç« ä¿å­˜API
ls app/api/articles/route.ts
```

### 2. å¦‚æœç¼ºå°‘ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ›å»º

å‘Šè¯‰æˆ‘ï¼š
- [ ] éœ€è¦åˆ›å»ºå›¾ç‰‡ä¸Šä¼ APIå—ï¼Ÿ
- [ ] éœ€è¦åˆ›å»ºæ–‡ç« ä¿å­˜APIå—ï¼Ÿ
- [ ] éœ€è¦ä¿®æ”¹å‘å¸ƒé€»è¾‘å—ï¼Ÿ
- [ ] éœ€è¦æ·»åŠ äºŒç»´ç æ˜¾ç¤ºç•Œé¢å—ï¼Ÿ

### 3. æµ‹è¯•å‘å¸ƒæµç¨‹

1. ä¸Šä¼ 1-18å¼ å›¾ç‰‡
2. ç¼–è¾‘æ ‡é¢˜ã€æ­£æ–‡ã€æ ‡ç­¾
3. ç‚¹å‡»"é¢„è§ˆç¬”è®°"ç¡®è®¤æ•ˆæœ
4. ç‚¹å‡»"å‘å¸ƒç¬”è®°"
5. ç­‰å¾…ä¸Šä¼ å’Œå¤„ç†
6. çœ‹åˆ°äºŒç»´ç 
7. æ‰‹æœºæ‰«ç å®Œæˆå‘å¸ƒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [MyAIBot APIæ–‡æ¡£](https://www.myaibot.vip/docs/api)
- [å°çº¢ä¹¦å›¾ç‰‡è§„èŒƒ](./å›¾ç‰‡ä¸Šä¼ å’Œå‘å¸ƒæŒ‡å—.md)
- [Vercel Blobæ–‡æ¡£](https://vercel.com/docs/storage/vercel-blob)
- [Gemini Vision API](https://ai.google.dev/gemini-api/docs/vision)

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**è¯·å‘Šè¯‰æˆ‘**ï¼š

1. æ˜¯å¦éœ€è¦æˆ‘ç°åœ¨å®Œå–„å‘å¸ƒåŠŸèƒ½ï¼Ÿï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
2. "æœ¬åœ°å›¾ç‰‡è¯†åˆ«"çš„å…·ä½“éœ€æ±‚æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆéœ€è¦æ¾„æ¸…ï¼‰
3. æ˜¯å¦æœ‰å…¶ä»–åŠŸèƒ½éœ€æ±‚ï¼Ÿ

æˆ‘å¯ä»¥ç«‹å³å¼€å§‹ç¼–å†™ä»£ç ï¼

---

**æ–‡æ¡£ç»´æŠ¤è€…**ï¼šClaude Code
**æœ€åæ›´æ–°**ï¼š2026-02-06
**ç›¸å…³æ–‡ä»¶**ï¼š
- `app/rewrite/page.tsx` - å¤åˆ»é¡µé¢
- `components/XiaohongshuPreview.tsx` - é¢„è§ˆç»„ä»¶
- `app/api/xiaohongshu/publish/route.ts` - å‘å¸ƒAPI
