# 三张表格 + 备注功能配置指南

**日期**：2026-02-16
**功能**：支持3张飞书表格（意大利、西班牙、聚光投放） + 备注输入

---

## 📋 功能概述

### 新增功能
1. **三张独立表格**
   - 意大利目的地笔记
   - 西班牙目的地笔记
   - 聚光投放笔记（不区分目的地）

2. **备注字段**
   - 快捷指令中输入备注
   - 自动保存到飞书表格"备注"列

---

## 🗂️ 第一步：创建3张飞书表格

### 1.1 创建表格

在飞书多维表格中创建3张新表格：

**表格1：意大利笔记**
- 表格名称：`意大利` 或 `Italy`

**表格2：西班牙笔记**
- 表格名称：`西班牙` 或 `Spain`

**表格3：聚光投放笔记**
- 表格名称：`聚光投放` 或 `Ads`

---

### 1.2 配置表格字段（所有3张表格使用相同结构）

| 列号 | 字段名称 | 字段类型 | 说明 |
|------|----------|----------|------|
| 1 | 笔记链接 | 文本 | 小红书笔记URL |
| 2 | 作者昵称 | 文本 | 笔记作者 |
| 3 | 封面 | 附件 | 第1张图片 |
| 4 | 图片2 | 附件 | 第2张图片 |
| 5 | 后续图片 | 附件 | 第3张及以后 |
| 6 | 标题 | 文本 | 笔记标题 |
| 7 | 正文 | 多行文本 | 笔记内容 |
| 8 | 话题标签 | 文本 | #话题1 #话题2 |
| 9 | 浏览数 | 数字 | 浏览量 |
| 10 | 点赞数 | 数字 | 点赞数 |
| 11 | 收藏数 | 数字 | 收藏数 |
| 12 | 评论数 | 数字 | 评论数 |
| 13 | 发布时间 | 日期 | 笔记发布日期 |
| 14 | **备注** | 多行文本 | **新增：快捷指令输入** ⭐ |
| 15 | 复刻情况 | 按钮 | 可选 |

**重要提示：**
1. 字段名称必须完全一致（包括空格和大小写）
2. "备注"字段可以是"文本"或"多行文本"类型
3. 3张表格的字段结构完全相同

---

### 1.3 获取表格ID

#### 方法1：从URL获取（推荐）⭐

打开表格，查看浏览器地址栏：
```
https://xxx.feishu.cn/base/XXXXappTokenXXXX?table=YYYYtableIdYYYY&view=...
                           ^^^^^^^^^^^^^^^^        ^^^^^^^^^^^^^^^
                           这是 app_token          这是 table_id
```

#### 方法2：使用飞书开放平台工具

1. 访问：https://open.feishu.cn/app
2. 找到你的应用
3. 使用"数据表管理"工具获取ID

---

### 1.4 记录3张表格的信息

填写以下信息（后面配置时需要用到）：

```
表格1：意大利
- app_token: NNd8bJYazaBwHAsZ2z2cqsvmnqf（示例，替换为你的）
- table_id: tbl_italy_xxxxx（示例，替换为你的）

表格2：西班牙
- app_token: NNd8bJYazaBwHAsZ2z2cqsvmnqf（通常相同）
- table_id: tbl_spain_xxxxx（示例，替换为你的）

表格3：聚光投放
- app_token: NNd8bJYazaBwHAsZ2z2cqsvmnqf（通常相同）
- table_id: tbl_ads_xxxxx（示例，替换为你的）
```

**提示：** 如果3张表格在同一个多维表格应用下，`app_token`是相同的。

---

### 1.5 配置飞书应用权限

确保你的飞书应用有访问3张表格的权限：

1. 打开每张表格
2. 点击右上角"协作" → "添加协作者"
3. 添加以下应用：
   - `内容工厂-数据同步`
   - `小红书笔记采集`
   - `多维表格助手`
4. 权限设置为"可编辑"

---

## 📱 第二步：配置iOS快捷指令

### 2.1 快捷指令完整流程

```
1. 获取剪贴板（小红书链接）
2. 从菜单中选择（选择目的地）← 新增
3. 要求输入（输入备注）← 新增
4. 构建JSON请求体
5. 获取URL内容（调用API）
6. 显示通知（显示结果）
```

---

### 2.2 详细配置步骤

#### ✅ 步骤1：获取剪贴板

操作：`获取剪贴板`

---

#### ✅ 步骤2：选择目的地（新增）⭐

操作：`从菜单中选择`

**配置：**
```
提示：选择目的地表格
菜单项：
  - 意大利
  - 西班牙
  - 聚光投放
```

**截图示例：**
```
┌─────────────────────────┐
│ 从菜单中选择              │
├─────────────────────────┤
│ 提示: 选择目的地表格      │
│ 菜单项:                  │
│   • 意大利               │
│   • 西班牙               │
│   • 聚光投放             │
└─────────────────────────┘
```

---

#### ✅ 步骤3：输入备注（新增）⭐

操作：`要求输入`

**配置：**
```
提示：输入备注（可选）
输入类型：文本
允许多行：是
默认答案：（留空）
```

**截图示例：**
```
┌─────────────────────────┐
│ 要求输入                 │
├─────────────────────────┤
│ 提示: 输入备注（可选）    │
│ 输入类型: 文本           │
│ 允许多行: 是             │
│ 默认答案: [空]           │
└─────────────────────────┘
```

---

#### ✅ 步骤4：如果语句 - 意大利

操作：`如果`

**配置：**
```
如果: 从菜单中选择 等于 意大利
```

**在"如果"块内部：**

##### 4.1 设置变量 - app_token
```
操作：设置变量
变量名：app_token
值：NNd8bJYazaBwHAsZ2z2cqsvmnqf（替换为你的意大利表格app_token）
```

##### 4.2 设置变量 - table_id
```
操作：设置变量
变量名：table_id
值：tbl_italy_xxxxx（替换为你的意大利表格table_id）
```

---

#### ✅ 步骤5：否则如果 - 西班牙

**配置：**
```
否则 如果: 从菜单中选择 等于 西班牙
```

**在"否则如果"块内部：**

##### 5.1 设置变量 - app_token
```
操作：设置变量
变量名：app_token
值：NNd8bJYazaBwHAsZ2z2cqsvmnqf（替换为你的西班牙表格app_token）
```

##### 5.2 设置变量 - table_id
```
操作：设置变量
变量名：table_id
值：tbl_spain_xxxxx（替换为你的西班牙表格table_id）
```

---

#### ✅ 步骤6：否则 - 聚光投放

**在"否则"块内部：**

##### 6.1 设置变量 - app_token
```
操作：设置变量
变量名：app_token
值：NNd8bJYazaBwHAsZ2z2cqsvmnqf（替换为你的聚光投放表格app_token）
```

##### 6.2 设置变量 - table_id
```
操作：设置变量
变量名：table_id
值：tbl_ads_xxxxx（替换为你的聚光投放表格table_id）
```

---

#### ✅ 步骤7：构建JSON请求体

操作：`文本`

**配置：**
```json
{
  "url": "剪贴板",
  "appToken": "app_token",
  "tableId": "table_id",
  "remark": "提供的输入",
  "async": false
}
```

**重要：插入变量的方式**
1. 在`"`和`"`之间长按，选择"选择变量"
2. 对应关系：
   - `"url": "剪贴板"` ← 插入"获取剪贴板"的结果
   - `"appToken": "app_token"` ← 插入"app_token"变量
   - `"tableId": "table_id"` ← 插入"table_id"变量
   - `"remark": "提供的输入"` ← 插入"要求输入"的结果 ⭐ 新增
   - `"async": false` ← 手动输入（不是变量）

---

#### ✅ 步骤8：获取URL内容

操作：`获取URL内容`

**配置：**
```
URL: https://your-domain.vercel.app/api/xiaohongshu/quick-save
方法: POST
请求体: 文件（选择上一步的"文本"）
标头:
  - Content-Type: application/json
```

---

#### ✅ 步骤9：显示通知

操作：`显示通知`

**配置：**
```
标题：小红书采集
正文：URL内容的 message 字段
```

**插入变量方式：**
- 在"正文"中长按 → "选择变量" → "URL内容" → "message"

---

## 📝 第三步：快捷指令JSON配置（供参考）

如果你熟悉快捷指令的JSON编辑，可以参考以下结构：

```json
{
  "actions": [
    {
      "type": "获取剪贴板"
    },
    {
      "type": "从菜单中选择",
      "parameters": {
        "prompt": "选择目的地表格",
        "items": ["意大利", "西班牙", "聚光投放"]
      }
    },
    {
      "type": "要求输入",
      "parameters": {
        "prompt": "输入备注（可选）",
        "inputType": "文本",
        "multiline": true
      }
    },
    {
      "type": "如果",
      "condition": "从菜单中选择 == 意大利",
      "then": [
        {
          "type": "设置变量",
          "name": "app_token",
          "value": "你的意大利app_token"
        },
        {
          "type": "设置变量",
          "name": "table_id",
          "value": "你的意大利table_id"
        }
      ],
      "elseif": [
        {
          "condition": "从菜单中选择 == 西班牙",
          "then": [
            {
              "type": "设置变量",
              "name": "app_token",
              "value": "你的西班牙app_token"
            },
            {
              "type": "设置变量",
              "name": "table_id",
              "value": "你的西班牙table_id"
            }
          ]
        }
      ],
      "else": [
        {
          "type": "设置变量",
          "name": "app_token",
          "value": "你的聚光投放app_token"
        },
        {
          "type": "设置变量",
          "name": "table_id",
          "value": "你的聚光投放table_id"
        }
      ]
    },
    {
      "type": "文本",
      "text": "{\n  \"url\": \"[剪贴板]\",\n  \"appToken\": \"[app_token]\",\n  \"tableId\": \"[table_id]\",\n  \"remark\": \"[提供的输入]\",\n  \"async\": false\n}"
    },
    {
      "type": "获取URL内容",
      "url": "https://your-domain.vercel.app/api/xiaohongshu/quick-save",
      "method": "POST",
      "body": "文件",
      "headers": {
        "Content-Type": "application/json"
      }
    },
    {
      "type": "显示通知",
      "title": "小红书采集",
      "body": "[URL内容.message]"
    }
  ]
}
```

---

## 🧪 第四步：测试

### 4.1 测试流程

1. **复制小红书链接** 到剪贴板
   ```
   https://www.xiaohongshu.com/explore/684aa03a000000002202750b
   ```

2. **运行快捷指令**
   - 选择目的地：意大利
   - 输入备注：这是一个测试笔记
   - 等待处理

3. **检查结果**
   - 查看通知是否显示"保存成功"
   - 打开飞书"意大利"表格
   - 确认笔记已保存，且"备注"列显示"这是一个测试笔记"

---

### 4.2 测试检查清单

- [ ] 意大利表格能正常保存
- [ ] 西班牙表格能正常保存
- [ ] 聚光投放表格能正常保存
- [ ] 备注字段能正确保存
- [ ] 图片能正常上传（3张以上的笔记）
- [ ] 不输入备注也能正常保存（备注为空）

---

## ❓ 常见问题

### Q1: 快捷指令报错"请提供小红书链接"
**原因：** JSON构建错误，变量插入位置不对
**解决：**
1. 检查"url"字段是否正确插入了"剪贴板"变量
2. 确保在`"`和`"`之间插入变量，不是直接输入文字

---

### Q2: 表格报错"Forbidden"
**原因：** 表格缺少应用协作权限
**解决：**
1. 打开表格 → 协作 → 添加协作者
2. 添加应用：内容工厂-数据同步、小红书笔记采集
3. 权限设置为"可编辑"

---

### Q3: 备注字段没有保存
**原因：**
1. 飞书表格没有创建"备注"字段
2. 字段名称不匹配（如：备註、Remark等）

**解决：**
1. 确认表格有"备注"字段（字段类型：文本或多行文本）
2. 字段名称必须是"备注"（中文，简体）

---

### Q4: 想跳过备注输入
**方案1：** 点击"取消"或留空直接确认
**方案2：** 修改快捷指令，移除"要求输入"步骤，在JSON中设置：
```json
"remark": ""
```

---

### Q5: 如何添加第4个、第5个表格？
**步骤：**
1. 飞书中创建新表格
2. 获取新表格的table_id
3. 在快捷指令的"从菜单中选择"中添加新选项
4. 在"如果"语句中添加新的"否则如果"分支
5. 设置对应的app_token和table_id

---

## 📊 数据流示意图

```
┌─────────────────────────────────────────────────────┐
│               iOS 快捷指令                            │
├─────────────────────────────────────────────────────┤
│ 1. 获取剪贴板（小红书链接）                           │
│ 2. 选择目的地（意大利/西班牙/聚光投放）                 │
│ 3. 输入备注（可选）                                   │
│ 4. 构建JSON:                                         │
│    {                                                 │
│      "url": "https://...",                           │
│      "appToken": "NNd8bJ...",                        │
│      "tableId": "tbl_...",                           │
│      "remark": "这是备注内容"  ← 新增                 │
│    }                                                 │
└───────────────────────┬─────────────────────────────┘
                        │ POST /api/xiaohongshu/quick-save
                        ↓
┌─────────────────────────────────────────────────────┐
│               Vercel API                             │
├─────────────────────────────────────────────────────┤
│ 1. 解析小红书链接（极致了API）                        │
│ 2. 下载图片                                          │
│ 3. 上传图片到飞书（获取file_token）                   │
│ 4. 保存到飞书表格（包含备注字段）← 新增               │
└───────────────────────┬─────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│            飞书多维表格                               │
├─────────────────────────────────────────────────────┤
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐   │
│ │   意大利     │ │   西班牙     │ │  聚光投放    │   │
│ ├─────────────┤ ├─────────────┤ ├─────────────┤   │
│ │ 笔记1        │ │ 笔记A        │ │ 笔记X        │   │
│ │ 备注: ...    │ │ 备注: ...    │ │ 备注: ...    │   │
│ │ 笔记2        │ │ 笔记B        │ │ 笔记Y        │   │
│ │ 备注: ...    │ │ 备注: ...    │ │ 备注: ...    │   │
│ └─────────────┘ └─────────────┘ └─────────────┘   │
└─────────────────────────────────────────────────────┘
```

---

## 🎯 总结

### 优势
✅ 分类管理：不同目的地的笔记分开存储
✅ 灵活备注：可以记录采集时的想法、标签、用途等
✅ 快速操作：2秒完成选择和输入
✅ 兼容现有：不影响现有的快捷指令和表格

### 注意事项
⚠️ 3张表格的字段结构必须完全相同
⚠️ "备注"字段名称必须准确匹配（中文简体）
⚠️ 确保3张表格都有应用协作权限
⚠️ 备注可以留空，不影响保存

---

## 📞 技术支持

### 日志查看
如果遇到问题，可以查看Vercel日志：
1. 访问：https://vercel.com/your-project
2. 点击"Logs"
3. 找到最近的API调用记录
4. 查看详细错误信息

### 关键日志标识
```
[快捷保存] 收到请求: { url: '...', remark: '...' }
[快捷保存-飞书] 备注内容: ...
[快捷保存-飞书] 保存成功，记录 ID: ...
```

---

**文档创建时间：** 2026-02-16
**API修改提交：** 待提交
**测试状态：** 待测试
