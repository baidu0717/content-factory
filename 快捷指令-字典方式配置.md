# 快捷指令 - 字典方式配置（最稳定）

## 问题原因

iOS 快捷指令的 JSON 编辑器在处理变量时可能出现序列化问题，导致：
- 变量没有正确插入到 JSON 中
- JSON 格式错误
- 参数没有传递到服务器

## 解决方案：用「词典」+ 转换为 JSON

### 完整步骤

#### 操作1-5：前面保持不变
```
1. 获取剪贴板
2. 从菜单中选择（法意瑞/其他国家）
3-5. If/Else 设置 appToken 和 tableId 变量
```

#### 操作6：创建词典（新方法）⭐

**删除原来的「获取 URL 内容」，用以下3步代替：**

##### 步骤A：设置词典
- 添加「设定变量」操作
- 变量名：`requestBody`
- 值：点击变量框，选择「词典」

##### 步骤B：配置词典内容
在「词典」编辑器中，添加4个键值对：

**键值对1：**
- 键：`url`（纯文本）
- 值：选择「剪贴板」变量（蓝色标签）

**键值对2：**
- 键：`appToken`（纯文本）
- 值：选择「appToken」变量（橙色标签）

**键值对3：**
- 键：`tableId`（纯文本）
- 值：选择「tableId」变量（橙色标签）

**键值对4：**
- 键：`async`（纯文本）
- 值：`true`（纯文本，注意是小写）

##### 步骤C：发送请求
- 添加「获取 URL 内容」操作
- **URL**：`https://content-factory-jade-nine.vercel.app/api/xiaohongshu/quick-save`
- **方法**：`POST`
- **请求体**：选择「JSON」
- **JSON 内容**：选择「requestBody」变量（就是上一步创建的词典）

#### 操作7-8：解析响应（保持不变）
```
7. 从输入获取词典值 message
8. 显示通知
```

---

## 详细操作演示

### 第1步：删除原来的 API 调用
- 找到「获取 URL 内容」操作
- 点击该操作右上角的 `×` 删除

### 第2步：添加「设定变量」创建词典
1. 在「结束 If」后面，点击 `+` 添加操作
2. 搜索「设定变量」，选择它
3. 变量名输入：`requestBody`
4. 点击「值」输入框
5. 在弹出的菜单中，向下滑动找到并选择「词典」
6. 现在会出现一个词典编辑器

### 第3步：配置词典的4个键值对

#### 添加第1个：url
1. 点击「添加新项目」或 `+`
2. **键**（左侧）：输入 `url`（纯文本）
3. **值**（右侧）：点击后选择「剪贴板」变量

#### 添加第2个：appToken
1. 点击「添加新项目」或 `+`
2. **键**：输入 `appToken`
3. **值**：点击后选择「appToken」变量

#### 添加第3个：tableId
1. 点击「添加新项目」或 `+`
2. **键**：输入 `tableId`
3. **值**：点击后选择「tableId」变量

#### 添加第4个：async
1. 点击「添加新项目」或 `+`
2. **键**：输入 `async`
3. **值**：输入 `true`（纯文本，小写）

### 第4步：添加「获取 URL 内容」
1. 在「设定变量 requestBody」后面，点击 `+`
2. 搜索「获取 URL 内容」，选择它
3. **URL**：粘贴 `https://content-factory-jade-nine.vercel.app/api/xiaohongshu/quick-save`
4. **方法**：选择 `POST`
5. **请求体**：选择「JSON」
6. **JSON 内容**：点击输入框，选择「requestBody」变量（应该在变量列表中）

---

## 最终的快捷指令流程

```
1. 获取剪贴板
2. 从菜单中选择（法意瑞/其他国家）
3. 如果 = 法意瑞
   - 设定变量 appToken = NNd8bJYazaBwHAsZ2z2cqsvmnqf
   - 设定变量 tableId = tblu1m2GPcFRNSPE
4. 否则
   - 设定变量 appToken = McFGbxqi6aSd0HsBCSlc5kI7nwc
   - 设定变量 tableId = tbltp6uHpdKRF68a
5. 结束 If
6. 设定变量 requestBody = [词典]        ← 新增
   - url: [剪贴板]
   - appToken: [appToken]
   - tableId: [tableId]
   - async: true
7. 获取 URL 内容（POST，JSON = requestBody）
8. 从输入获取词典值 message
9. 显示通知
```

---

## 为什么这样更可靠？

1. **先构建词典**：所有变量都在词典中明确定义
2. **再转为 JSON**：快捷指令会自动将词典序列化为正确的 JSON
3. **避免手动编辑 JSON**：减少格式错误的可能性

---

## 调试技巧

如果还想确认词典内容，可以在「设定变量 requestBody」后面临时添加：

```
设定变量 requestBody = [词典]
↓
显示通知 [requestBody]  ← 临时添加，查看词典内容
↓
获取 URL 内容...
```

运行后查看通知，应该显示类似：
```
{
  "url": "http://xhslink.com/o/16GReUbltyS",
  "appToken": "NNd8bJYazaBwHAsZ2z2cqsvmnqf",
  "tableId": "tblu1m2GPcFRNSPE",
  "async": true
}
```

---

## 还是不行？最后的办法

如果上面的方法还是报错，那就用最原始的方法：**手动拼接 JSON 字符串**

### 添加「文本」操作
在「结束 If」后面，添加「文本」操作，内容：

```
{
  "url": "剪贴板变量",
  "appToken": "appToken变量",
  "tableId": "tableId变量",
  "async": true
}
```

**注意**：
- `"剪贴板变量"` 这里要删除引号内的文字，插入「剪贴板」变量
- `"appToken变量"` 这里要删除引号内的文字，插入「appToken」变量
- `"tableId变量"` 这里要删除引号内的文字，插入「tableId」变量

然后在「获取 URL 内容」中，JSON 内容选择这个「文本」变量。

---

试试字典方式，这个是最稳定的方法！
