# 快捷指令调试指南 - 方案B

## 问题：报错"请提供小红书链接"

### 原因分析
API 没有收到有效的 URL 参数，通常是因为快捷指令中变量没有正确设置。

---

## 解决方案

### 方法1：检查变量设置（最可能的问题）

在「获取 URL 内容」操作中，JSON 字段的设置：

#### ❌ 常见错误
如果你看到的是这样的**纯文本**：
```
{
  "url": "URL",
  "appToken": "appToken变量",
  "tableId": "tableId变量",
  "async": true
}
```

#### ✅ 正确做法
1. 点击 JSON 编辑区域
2. 对于 `"url"` 字段：
   - 删除引号内的 `URL` 文本
   - 点击该位置，选择「变量」
   - 从列表中选择「URL」（来自"从输入获取 URL"步骤）
   - 你应该看到一个**蓝色的变量标签**，而不是普通文本

3. 对于 `"appToken"` 字段：
   - 删除引号内的 `appToken变量` 文本
   - 点击该位置，选择「变量」
   - 从列表中选择「appToken」（来自 If/Else 中设定的变量）
   - 应该看到蓝色的变量标签

4. 对于 `"tableId"` 字段：
   - 删除引号内的 `tableId变量` 文本
   - 点击该位置，选择「变量」
   - 从列表中选择「tableId」（来自 If/Else 中设定的变量）
   - 应该看到蓝色的变量标签

#### 正确效果
设置完成后，JSON 应该看起来像这样（有蓝色标签）：
```
{
  "url": [URL 变量],
  "appToken": [appToken 变量],
  "tableId": [tableId 变量],
  "async": true
}
```

---

### 方法2：简化测试（排查是哪一步出错）

#### 步骤1：测试剪贴板
创建一个临时快捷指令：
1. 添加「获取剪贴板」
2. 添加「显示结果」显示剪贴板内容

**测试**：复制一个小红书链接，运行快捷指令，看是否能显示链接

---

#### 步骤2：测试 URL 提取
创建一个临时快捷指令：
1. 添加「获取剪贴板」
2. 添加「从输入获取 URL」
3. 添加「显示结果」显示 URL

**测试**：复制一个小红书链接，运行快捷指令，看是否能提取出 URL

---

#### 步骤3：测试变量设置
在你的快捷指令中，在「设定变量」后面添加「显示通知」：
```
设定变量 appToken = NNd8bJYazaBwHAsZ2z2cqsvmnqf
显示通知 "appToken: [appToken变量]"
```

**测试**：运行快捷指令，看通知中是否显示了正确的值

---

### 方法3：使用固定值测试（临时）

暂时不使用变量，先用固定值测试 API 是否正常：

在「获取 URL 内容」的 JSON 中，暂时改为：
```json
{
  "url": "手动粘贴一个实际的小红书链接",
  "appToken": "NNd8bJYazaBwHAsZ2z2cqsvmnqf",
  "tableId": "tblu1m2GPcFRNSPE",
  "async": true
}
```

**测试**：运行快捷指令，看是否能保存成功
- 如果成功 → 说明 API 正常，问题在变量设置
- 如果失败 → 说明 API 有问题，或者链接格式不对

---

## 完整的快捷指令流程检查清单

### ✅ 操作1：获取剪贴板
- [ ] 已添加「获取剪贴板」操作

### ✅ 操作2：获取 URL
- [ ] 已添加「从输入获取 URL」操作
- [ ] 输入来源：选择「剪贴板」变量

### ✅ 操作3：选择表格
- [ ] 已添加「从菜单中选择」操作
- [ ] 提示文字：`选择保存到哪个表格`
- [ ] 菜单项1：`个人表格`
- [ ] 菜单项2：`工作表格`

### ✅ 操作4-5：If/Else 设置变量
- [ ] 已添加「如果」操作
- [ ] 条件：「菜单结果」等于 `个人表格`
- [ ] If 块中第一个「设定变量」：
  - 变量名：`appToken`
  - 值：`NNd8bJYazaBwHAsZ2z2cqsvmnqf`
- [ ] If 块中第二个「设定变量」：
  - 变量名：`tableId`
  - 值：`tblu1m2GPcFRNSPE`
- [ ] Else 块中第一个「设定变量」：
  - 变量名：`appToken`
  - 值：`McFGbxqi6aSd0HsBCSlc5kI7nwc`
- [ ] Else 块中第二个「设定变量」：
  - 变量名：`tableId`
  - 值：`tbltp6uHpdKRF68a`

### ✅ 操作6：结束 If
- [ ] 已添加「结束 If」

### ✅ 操作7：调用 API
- [ ] 已添加「获取 URL 内容」操作
- [ ] URL：`https://content-factory-jade-nine.vercel.app/api/xiaohongshu/quick-save`
- [ ] 方法：`POST`
- [ ] 请求体：`JSON`
- [ ] JSON 内容：
  - `"url"` 的值是 **蓝色的 URL 变量**（不是文本 "URL"）
  - `"appToken"` 的值是 **蓝色的 appToken 变量**（不是文本）
  - `"tableId"` 的值是 **蓝色的 tableId 变量**（不是文本）
  - `"async": true` 是固定文本

### ✅ 操作8：解析响应
- [ ] 已添加「从输入获取词典值」操作
- [ ] 获取：`message`
- [ ] 从：选择「URL 内容」变量

### ✅ 操作9：显示结果
- [ ] 已添加「显示通知」或「显示结果」操作
- [ ] 显示：选择「词典值」变量

---

## 常见错误对照表

| 错误信息 | 原因 | 解决方法 |
|---------|------|---------|
| ❌ 请提供小红书链接 | URL 参数未传递或为空 | 检查 JSON 中 url 是否为变量 |
| ❌ 未配置飞书表格信息 | appToken/tableId 未传递 | 检查 JSON 中变量是否正确设置 |
| ❌ 无法从URL中提取note_id | 链接格式不对 | 确认复制的是小红书笔记链接 |
| ❌ 极致了API: 所有渠道不可用 | API 临时波动 | 等待几分钟后重试 |

---

## 推荐：改用方案A（更简单）

如果方案B的变量设置太复杂，建议改用**方案A**：

创建两个独立的快捷指令，每个指令的 JSON 都用固定值：

### 快捷指令1：小红书→个人
```json
{
  "url": [URL 变量],
  "appToken": "NNd8bJYazaBwHAsZ2z2cqsvmnqf",
  "tableId": "tblu1m2GPcFRNSPE",
  "async": true
}
```

### 快捷指令2：小红书→工作
```json
{
  "url": [URL 变量],
  "appToken": "McFGbxqi6aSd0HsBCSlc5kI7nwc",
  "tableId": "tbltp6uHpdKRF68a",
  "async": true
}
```

这样只需要设置一个 URL 变量，不需要 If/Else 逻辑，出错的可能性大大降低。

---

需要更多帮助吗？可以截图你的快捷指令配置，我帮你具体分析！
