# 快捷指令改进版 - 支持小红书复制的复杂文本

## 问题分析

小红书 App 复制的内容格式：
```
冬天的五渔村🇮🇹 走马观花五渔村 在La Spezia可以买... http://xhslink.com/o/16GReUbltyS
复制后打开【小红书】查看笔记！
```

这种格式包含多余的文字，需要改进快捷指令来提取纯 URL。

---

## 改进方案

### 修改步骤（在原快捷指令基础上调整）

#### 步骤1：获取剪贴板
- ✅ 保持不变

#### 步骤2：匹配文本（新增）⭐ 关键步骤
- **操作**：添加「匹配文本」操作
- **输入**：选择「剪贴板」变量
- **模式**：`正则表达式`（点击"文本"切换为"正则表达式"）
- **正则表达式**：
  ```regex
  https?://[^\s]+
  ```
  这个正则会匹配 `http://` 或 `https://` 开头的完整 URL

#### 步骤3：获取第一项（新增）
- **操作**：添加「从列表获取项目」操作
- **输入**：选择上一步「匹配的文本」变量
- **获取**：`第一项`

#### 步骤4：从菜单中选择
- ✅ 保持不变（法意瑞/其他国家）

#### 步骤5-6：If/Else 设置变量
- ✅ 保持不变

#### 步骤7：结束 If
- ✅ 保持不变

#### 步骤8：获取 URL 内容（调用 API）
- **修改**：JSON 中的 `url` 字段改为使用「列表中的第一项」变量（而不是之前的"URL"变量）
- JSON 配置：
  ```
  {
    "url": [列表中的第一项],
    "appToken": [appToken变量],
    "tableId": [tableId变量],
    "async": true
  }
  ```

#### 步骤9-10：解析响应并显示
- ✅ 保持不变

---

## 完整流程（改进版）

```
1. 获取剪贴板
2. 匹配文本（正则：https?://[^\s]+）  ← 新增
3. 从列表获取第一项                   ← 新增
4. 从菜单中选择（法意瑞/其他国家）
5. 如果 = 法意瑞
   - 设定变量 appToken = NNd8bJYazaBwHAsZ2z2cqsvmnqf
   - 设定变量 tableId = tblu1m2GPcFRNSPE
6. 否则
   - 设定变量 appToken = McFGbxqi6aSd0HsBCSlc5kI7nwc
   - 设定变量 tableId = tbltp6uHpdKRF68a
7. 结束 If
8. 获取 URL 内容（POST API，JSON 使用变量）
9. 从输入获取词典值 message
10. 显示通知
```

---

## 具体操作步骤

### 1. 删除原来的「从输入获取 URL」操作
在你的快捷指令中，删除第2步「从 剪贴板 获取 URL」

### 2. 添加「匹配文本」操作
- 在「获取剪贴板」后面，点击 `+` 添加操作
- 搜索「匹配文本」，选择该操作
- **文本**：选择「剪贴板」变量
- **模式**：点击右侧切换为「正则表达式」
- **正则表达式**：输入 `https?://[^\s]+`

### 3. 添加「从列表获取项目」操作
- 在「匹配文本」后面，点击 `+` 添加操作
- 搜索「获取」，选择「从列表获取项目」
- **列表**：选择「匹配的文本」变量
- **获取**：选择「第一项」

### 4. 修改「获取 URL 内容」中的 JSON
- 找到「获取 URL 内容」操作
- 点击 JSON 区域
- 找到 `"url"` 字段
- 点击当前的「URL」变量，删除它
- 选择「列表中的第一项」变量

---

## 测试

### 测试文本1（小红书复制的格式）
```
冬天的五渔村🇮🇹 走马观花五渔村 在La Spezia可以买... http://xhslink.com/o/16GReUbltyS
复制后打开【小红书】查看笔记！
```
**预期结果**：提取出 `http://xhslink.com/o/16GReUbltyS`

### 测试文本2（纯链接）
```
https://www.xiaohongshu.com/explore/684aa03a000000002202750b
```
**预期结果**：提取出完整链接

### 测试文本3（短链接）
```
http://xhslink.com/o/16GReUbltyS
```
**预期结果**：提取出短链接

---

## 调试技巧

如果还是有问题，在「从列表获取第一项」后面临时添加「显示结果」操作，查看提取出的 URL 是否正确：

```
1. 获取剪贴板
2. 匹配文本（正则）
3. 从列表获取第一项
4. 显示结果 ← 临时添加，用于调试
```

运行后查看显示的 URL 是否正确，确认后再删除这个调试步骤。

---

## 方法2：更简单的复制方式（推荐给用户）

在小红书 App 中：
1. 打开笔记
2. 点击右上角「···」
3. 选择「复制链接」（**不要**选择「分享」→「复制」）
4. 这样复制的就是纯链接，不会有额外文字

---

## 为什么要用正则表达式？

iOS 的「从输入获取 URL」操作在处理复杂文本时可能不准确，尤其是：
- 包含多个 URL
- URL 周围有大量文字
- 有特殊字符（Emoji等）

使用正则表达式 `https?://[^\s]+` 可以：
- 精确匹配以 `http://` 或 `https://` 开头的字符串
- 提取到第一个空格前的所有字符
- 适用于各种复杂文本格式

---

需要我帮你截图演示如何修改快捷指令吗？
