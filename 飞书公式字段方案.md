# 飞书多维表格 - 复刻链接公式字段方案

## 问题原因

飞书按钮字段的"打开链接"功能**不支持**使用 `{{字段名}}` 引用其他字段值。
这个语法只在飞书的"自动化"(Automation)功能中可用，不适用于按钮字段。

## 解决方案：使用公式字段

### 步骤1：创建公式字段

1. 在飞书多维表格中，点击右侧"+"添加新字段
2. 字段名称：`复刻链接`
3. 字段类型：选择 **"公式"**

### 步骤2：输入公式

在公式编辑器中输入以下公式：

```
CONCATENATE(
  "https://content-factory-jade-nine.vercel.app/rewrite?title=",
  ENCODEURL(标题),
  "&content=",
  ENCODEURL(正文),
  "&tags=",
  ENCODEURL(话题标签)
)
```

⚠️ **重要提示**：
- 如果您的飞书表格中正文字段名是 `正文内容`，请将公式中的 `正文` 改为 `正文内容`
- 如果字段名不匹配，公式会报错

### 完整公式（如果字段名是"正文内容"）：

```
CONCATENATE(
  "https://content-factory-jade-nine.vercel.app/rewrite?title=",
  ENCODEURL(标题),
  "&content=",
  ENCODEURL(正文内容),
  "&tags=",
  ENCODEURL(话题标签)
)
```

### 步骤3：使用链接

1. 保存公式后，每一行的"复刻链接"列会自动生成完整的URL
2. 直接点击这个链接，就会打开复刻页面并自动填充数据
3. 公式会自动处理URL编码，包括 `#` 和空格等特殊字符

## 公式说明

- `CONCATENATE()`: 将多个文本连接在一起
- `ENCODEURL()`: 对文本进行URL编码（将 `#` 转为 `%23`，空格转为 `%20` 等）
- `标题`, `正文`, `话题标签`: 引用对应的字段值

## 优势

✅ 不需要手动配置按钮
✅ 自动处理URL编码
✅ 点击即可跳转并填充数据
✅ 公式自动更新，字段值变化时链接也会自动更新

## 示例

假设某一行数据：
- 标题：`春日京都赏樱攻略`
- 正文内容：`今天分享我的京都赏樱经验...`
- 话题标签：`#旅行 #京都 #樱花`

公式会生成：
```
https://content-factory-jade-nine.vercel.app/rewrite?title=%E6%98%A5%E6%97%A5%E4%BA%AC%E9%83%BD%E8%B5%8F%E6%A8%B1%E6%94%BB%E7%95%A5&content=%E4%BB%8A%E5%A4%A9%E5%88%86%E4%BA%AB%E6%88%91%E7%9A%84%E4%BA%AC%E9%83%BD%E8%B5%8F%E6%A8%B1%E7%BB%8F%E9%AA%8C...&tags=%23%E6%97%85%E8%A1%8C%20%23%E4%BA%AC%E9%83%BD%20%23%E6%A8%B1%E8%8A%B1
```

点击后会自动填充所有数据到复刻页面。

## 可选：仍然使用按钮字段

如果您仍然想使用按钮字段（更美观），可以：

1. 创建上述公式字段"复刻链接"
2. 创建按钮字段"去复刻"
3. 按钮类型：打开链接
4. **链接地址直接引用公式字段**：
   - 在按钮配置的链接地址输入框中，选择插入字段
   - 选择 `复刻链接` 字段

这样按钮会使用公式字段生成的URL，实现一键跳转。

## 如何确认字段名

如果您不确定字段名是"正文"还是"正文内容"，可以：

1. 在飞书表格中查看列名
2. 或者访问：http://localhost:3000/api/feishu/setup-fields

   这个API会显示表格中所有字段的名称

---

**总结**：使用公式字段是最可靠的方案，无需依赖飞书按钮字段的变量引用功能。
